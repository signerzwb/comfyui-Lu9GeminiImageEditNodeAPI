# Lu9Gemini 自定义API调用插件
## 节点分类
`Custom Nodes/Gemini Image Edit`

## 功能概述
基于 Google Gemini 2.5 Flash 模型 API 打造的通用型图片编辑节点，支持在 ComfyUI 工作流中通过**原始图片 + 自然语言指令**实现智能图像修改。深度适配 ComfyUI 张量格式，可无缝融入各类图像生成/处理流程，兼具高定制性与通用性。

## 核心特性
- ✅ **全参数可定制**
  - 接口 URL 自由配置：支持自定义 API 地址、模型名称占位符替换，适配私有部署/第三方代理接口，无需修改代码即可切换调用目标；
  - 编辑参数灵活调节：支持 1:1/4:3/16:9/9:16 比例、1080P/2K/4K 分辨率自定义，文本指令无固定限制（颜色修改/元素增减/风格转换等均可实现）。

- ✅ **高通用性适配**
  - 生态无缝兼容：输入输出均为 ComfyUI 标准 `IMAGE` 张量，可直接串联 `Load Image`/`Save Image`/`ControlNet` 等节点；
  - 格式自动转换：内置 Tensor↔Base64 双向转换逻辑，兼容 PNG 格式无损传输，无需手动处理格式适配；
  - 场景无界适配：覆盖设计优化、素材加工、风格迁移等多场景，自然语言指令驱动任意编辑需求。

- ✅ **稳定可靠易使用**
  - 网络容错机制：3 次自动重试 + 120 秒超时配置，有效应对网络波动/接口延迟问题；
  - 友好异常处理：调用失败时自动返回原始图片，日志输出完整错误堆栈，不中断工作流；
  - 零代码上手：全参数可视化配置，无需 API 调用/格式转换技术基础，新手可快速使用。

- ✅ **强扩展能力**
  - 模型自由切换：通过 `model_name` 参数快速切换 Gemini 系列模型（gemini-pro/gemini-ultra 等）；
  - 二次开发友好：代码结构清晰，可轻松扩展请求头、生成质量等自定义参数。

## 输入参数
| 参数名         | 类型    | 默认值                                   | 说明                                                                 |
|----------------|---------|------------------------------------------|----------------------------------------------------------------------|
| `image`        | `IMAGE` | -                                        | 待编辑的原始图片（ComfyUI 标准张量格式）                             |
| `edit_prompt`  | `STRING`| ""                                       | 图片编辑指令（自然语言，如“将背景改为蓝色，人物衣服变为红色”）       |
| `api_key`      | `STRING`| sk-你的密钥                              | Gemini API 调用密钥（格式为 sk-xxx）                                   |
| `api_url`      | `STRING`| https://147ai.com/v1beta/models/{model_name}:generateContent | 接口 URL 模板，`{model_name}` 自动替换为模型名称参数                     |
| `aspect_ratio` | `STRING`| 9:16                                     | 图片比例（可选 1:1/4:3/16:9/9:16）                                    |
| `image_size`   | `STRING`| 2K                                       | 图片分辨率（可选 1080P/2K/4K）                                        |
| `model_name`   | `STRING`| gemini-2.5-flash-image-preview           | 调用的 Gemini 模型名称（可选填）                                       |

## 输出参数
| 参数名         | 类型    | 说明                                   |
|----------------|---------|----------------------------------------|
| `edited_image` | `IMAGE` | 编辑后的图片（ComfyUI 标准张量格式）    |

## 适用场景
1.  **设计师/创作者**：快速调整图片风格、替换元素，提升素材制作效率；
2.  **AI 绘画爱好者**：融入 ComfyUI 工作流，扩展图像编辑能力；
3.  **开发者/研究者**：快速测试 Gemini API 不同参数/指令效果；
4.  **企业用户**：适配私有部署 API，实现合规化定制图像处理。

## 使用提示
1.  首次使用需填写有效 `api_key`，否则接口调用失败；
2.  `api_url` 支持固定地址（直接填写完整 URL）或模板（保留 `{model_name}` 自动替换）；
3.  编辑指令建议精准描述（如“将猫的毛色改为橘色”），避免模糊表述；
4.  调用失败时可查看 ComfyUI 控制台日志，定位密钥/URL/指令等问题。

是否需要我帮你生成**该节点的快速上手演示流程图**？
